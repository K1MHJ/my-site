---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Sidebar from "../../components/Sidebar.astro";
import { getAllPosts } from "../../lib/posts";

const posts = getAllPosts();
const tagMap = new Map<string, number>();

for (const p of posts) {
  if (!p.tags) continue;
  for (const t of p.tags) {
    tagMap.set(t, (tagMap.get(t) ?? 0) + 1);
  }
}

const tags = [...tagMap.entries()].sort((a, b) => {
  // 많이 쓰인 태그 우선, 같으면 이름 순
  if (b[1] !== a[1]) return b[1] - a[1];
  return a[0].localeCompare(b[0]);
});

const rawBase = import.meta.env.BASE_URL ?? "/";
const base = rawBase.endsWith("/") ? rawBase : `${rawBase}/`;
---

<BaseLayout title="태그 목록">
  <section>
    <h1 class="post-title">태그</h1>

    {tags.length === 0 ? (
      <p>아직 태그가 없습니다.</p>
    ) : (
      <ul class="post-list">
        {tags.map(([tag, count]) => (
          <li class="post-list-item">
            <a href={`${base}tags/${tag}/`} class="post-title">
              #{tag}
            </a>
            <span class="post-meta"> · {count}개 글</span>
          </li>
        ))}
      </ul>
    )}
  </section>

  <Sidebar slot="sidebar" />
</BaseLayout>
