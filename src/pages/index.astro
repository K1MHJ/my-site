---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

import TagCloud from "../components/TagCloud.astro";
import RecentPosts from "../components/RecentPosts.astro";
import ArchiveByMonth from "../components/ArchiveByMonth.astro";

const posts = (await getCollection("blog"))
  .filter((p) => !p.data.draft)
  .sort((a, b) => +b.data.date - +a.data.date)
  .slice(0, 10);


export async function GET() {
  return new Response(null, {
    status: 302,
    headers: { Location: "/1" },
  });
}

const { page } = Astro.props;
---

<BaseLayout title="일상의 기록">
  <div class="space-y-8">
    {posts.map((post) => (
      <article class="flex gap-4">
        {post.data.thumbnail && (
          <a href={`/posts/${post.slug}`} class="shrink-0">
            <img src={post.data.thumbnail} alt="" class="w-36 h-24 object-cover rounded-lg border" />
          </a>
        )}
        <div>
          <h2 class="text-xl font-semibold">
            <a href={`/posts/${post.slug}`}>{post.data.title}</a>
          </h2>
          <div class="text-sm text-gray-600">
            {post.data.date.toISOString().slice(0,10)}
            {post.data.tags.length ? ` · ${post.data.tags.join(", ")}` : ""}
          </div>
          {post.data.description && <p class="mt-1 text-gray-700">{post.data.description}</p>}
        </div>
      </article>
    ))}
  </div>

  <!-- 사이드바 슬롯들 채우기 -->
  <Fragment slot="sidebar-tags">
    <!-- 태그 클라우드 간단 버전 -->
    <TagCloud />
  </Fragment>
  <Fragment slot="sidebar-recent">
    <RecentPosts />
  </Fragment>
  <Fragment slot="sidebar-archive">
    <ArchiveByMonth />
  </Fragment>
</BaseLayout>