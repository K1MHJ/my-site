---
import BaseLayout from "../layouts/BaseLayout.astro";
import Sidebar from "../components/Sidebar.astro";
import { getAllPosts } from "../lib/posts";

const posts = getAllPosts();

const rawBase = import.meta.env.BASE_URL ?? "/";
const base = rawBase.endsWith("/") ? rawBase : `${rawBase}/`;
---

<BaseLayout title="일상의 기록">
  <section>
    {posts.length === 0 ? (
      <p>아직 작성된 글이 없습니다.</p>
    ) : (
      <ul class="post-list">
        {posts.map((post) => (
          <li class="post-list-item">
            <h2 class="post-title">
              <a href={`${base}posts/${post.slug}/`}>{post.title}</a>
            </h2>
            <div class="post-meta">
              {new Date(post.createdAt).toLocaleDateString("ko-KR")} ·{" "}
              {post.tags?.join(", ")}
            </div>
            {post.summary && (
              <p class="post-summary">{post.summary}</p>
            )}
          </li>
        ))}
      </ul>
    )}
  </section>

  <Sidebar slot="sidebar" />
</BaseLayout>
