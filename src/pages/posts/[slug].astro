---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Sidebar from "../../components/Sidebar.astro";
import { getAllPosts, getPostBySlug } from "../../lib/posts";

export async function getStaticPaths() {
  const posts = getAllPosts();
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { slug: post.slug },
  }));
}

const { slug } = Astro.params;
const post = getPostBySlug(slug);

if (!post) {
  throw new Error(`Post not found: ${slug}`);
}

const { frontmatter, Content } = post;
---

<BaseLayout title={frontmatter.title}>
  <article>
    <header>
      <h1 class="post-title">{frontmatter.title}</h1>
      {frontmatter.createdAt && (
        <div class="post-meta">
          {new Date(frontmatter.createdAt).toLocaleString("ko-KR")}
        </div>
      )}
      {frontmatter.tags && frontmatter.tags.length > 0 && (
        <p class="post-meta">
          {frontmatter.tags.map((tag) => (
            <span style="margin-right: 0.5rem;">#{tag}</span>
          ))}
        </p>
      )}
    </header>

    <section style="margin-top: 1rem;">
      <Content />
    </section>
  </article>

  <Sidebar slot="sidebar" />
</BaseLayout>
