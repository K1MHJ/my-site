---
import { getCollection } from "astro:content";
const posts = (await getCollection("blog"))
  .filter((p)=>!p.data.draft)
  .sort((a,b)=>+b.data.date - +a.data.date);

// "YYYY-MM"별 그룹
const byMonth = new Map<string, {title:string;slug:string}[]>();
for (const p of posts) {
  const key = p.data.date.toISOString().slice(0,7);
  const list = byMonth.get(key) ?? [];
  list.push({ title: p.data.title, slug: p.slug });
  byMonth.set(key, list);
}
const months = [...byMonth.entries()].sort((a,b)=> (a[0] < b[0] ? 1 : -1));
---
<div class="rounded-2xl border p-4">
  <h3 class="font-semibold mb-3">Archives</h3>
  <ul class="space-y-2 text-sm">
    {months.map(([m, list]) => (
      <li>
        <details>
          <summary class="cursor-pointer">{m} ({list.length})</summary>
          <ul class="mt-1 pl-4 list-disc">
            {list.map(i => <li><a href={`/posts/${i.slug}`}>{i.title}</a></li>)}
          </ul>
        </details>
      </li>
    ))}
  </ul>
</div>
